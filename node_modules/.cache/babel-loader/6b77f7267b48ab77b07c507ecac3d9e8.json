{"ast":null,"code":"import Axios from \"axios\";\nimport { logout, tokenName } from \"./Pages/authController\";\nimport { ME_URL, REFERESH_URL } from \"./urls\";\nexport const LastUserChat = \"lastUserChat\";\nexport const axiosHandler = _ref => {\n  let {\n    method = \"\",\n    url = \"\",\n    token = null,\n    data = {},\n    extra = null\n  } = _ref;\n  let methodType = method.toUpperCase();\n\n  if ([\"GET\", \"POST\", \"PATCH\", \"PUT\", \"DELETE\"].includes(methodType) || {}.toString(data) !== \"[object Object]\") {\n    let axiosProps = {\n      method: methodType,\n      url,\n      data\n    };\n\n    if (token) {\n      axiosProps.headers = {\n        Authorization: `Bearer ${token}`\n      };\n    }\n\n    if (extra) {\n      axiosProps.headers = { ...axiosProps.headers,\n        ...extra\n      };\n    }\n\n    return Axios(axiosProps);\n  } else {\n    alert(`method ${methodType} is not accepted or data is not an object`);\n  }\n};\nexport const errorHandler = function (err) {\n  let defaulted = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  if (defaulted) {\n    return \"Ops!, an error occurred.\";\n  }\n\n  let messageString = \"\";\n\n  if (!err.response) {\n    messageString += \"Network error! check your network and try again\";\n  } else {\n    let data = err.response.data.results;\n\n    if (!err.response.data.results) {\n      data = err.response.data;\n    }\n\n    messageString = loopObj(data);\n  }\n\n  return messageString.replace(/{|}|'|\\[|\\]/g, \"\");\n};\n\nconst loopObj = obj => {\n  let agg = \"\";\n\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      agg += `<div>${key}: ${typeof obj[key] === \"object\" ? loopObj(obj[key]) : obj[key]}</div>`;\n    }\n  }\n\n  return agg;\n};\n\nexport const getToken = async props => {\n  let token = localStorage.getItem(tokenName);\n  if (!token) logout(props);\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access\n  }).catch(e => null);\n\n  if (userProfile) {\n    return token.access;\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh\n      }\n    }).catch(e => null);\n\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      return getNewAccess.data.access;\n    } else {\n      logout(props);\n    }\n  }\n};","map":{"version":3,"names":["Axios","logout","tokenName","ME_URL","REFERESH_URL","LastUserChat","axiosHandler","method","url","token","data","extra","methodType","toUpperCase","includes","toString","axiosProps","headers","Authorization","alert","errorHandler","err","defaulted","messageString","response","results","loopObj","replace","obj","agg","key","hasOwnProperty","getToken","props","localStorage","getItem","JSON","parse","userProfile","access","catch","e","getNewAccess","refresh","setItem","stringify"],"sources":["F:/coding/python/Django_Project/chat_service/chatfrontend/src/helper.js"],"sourcesContent":["import Axios from \"axios\";\nimport { logout, tokenName } from \"./Pages/authController\";\nimport { ME_URL, REFERESH_URL } from \"./urls\";\n\nexport const LastUserChat = \"lastUserChat\";\n\nexport const axiosHandler = ({\n  method = \"\",\n  url = \"\",\n  token = null,\n  data = {},\n  extra = null,\n}) => {\n  let methodType = method.toUpperCase();\n  if (\n    [\"GET\", \"POST\", \"PATCH\", \"PUT\", \"DELETE\"].includes(methodType) ||\n    {}.toString(data) !== \"[object Object]\"\n  ) {\n    let axiosProps = { method: methodType, url, data };\n\n    if (token) {\n      axiosProps.headers = { Authorization: `Bearer ${token}` };\n    }\n    if (extra) {\n      axiosProps.headers = { ...axiosProps.headers, ...extra };\n    }\n    return Axios(axiosProps);\n  } else {\n    alert(`method ${methodType} is not accepted or data is not an object`);\n  }\n};\n\nexport const errorHandler = (err, defaulted = false) => {\n  if (defaulted) {\n    return \"Ops!, an error occurred.\";\n  }\n\n  let messageString = \"\";\n  if (!err.response) {\n    messageString += \"Network error! check your network and try again\";\n  } else {\n    let data = err.response.data.results;\n    if (!err.response.data.results) {\n      data = err.response.data;\n    }\n    messageString = loopObj(data);\n  }\n  return messageString.replace(/{|}|'|\\[|\\]/g, \"\");\n};\n\nconst loopObj = (obj) => {\n  let agg = \"\";\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      agg += `<div>${key}: ${\n        typeof obj[key] === \"object\" ? loopObj(obj[key]) : obj[key]\n      }</div>`;\n    }\n  }\n  return agg;\n};\n\nexport const getToken = async (props) => {\n  let token = localStorage.getItem(tokenName);\n  if (!token) logout(props);\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access,\n  }).catch((e) => null);\n  if (userProfile) {\n    return token.access;\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh,\n      },\n    }).catch((e) => null);\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      return getNewAccess.data.access;\n    } else {\n      logout(props);\n    }\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}